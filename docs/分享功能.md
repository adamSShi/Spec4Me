# 📍 iMap 地圖分享功能 - 產品需求規格書

> **文件版本**: 1.0.0  
> **建立日期**: 2025-12-15  
> **產品負責人**: iMap PM  
> **狀態**: ✅ 已完成

---

## 1. 功能概述

### 1.1 功能目的

讓使用者能夠將地圖上的「**位置**」或「**特定地點資訊**」分享給親友，接收者點擊連結後可直接看到相同的地圖畫面與資訊。

### 1.2 目標用戶

- 一般市民：分享景點、活動地點給親友
- 通勤族：分享 YouBike 站點位置
- 所有 iMap 使用者

---

## 2. 功能範圍

### 2.1 分享類型

| 類型 | 說明 | 入口 |
|------|------|------|
| **位置分享** | 分享地圖上任意一個位置 | 地圖右上角「分享」按鈕 |
| **項目分享** | 分享特定的 YouBike 站點或活動 | 資訊卡片上的「分享」按鈕 |

### 2.2 支援分享的項目

| 項目 | 分享支援 |
|------|----------|
| YouBike 站點 | ✅ 支援 |
| 活動地圖 | ✅ 支援 |
| WiFi 熱點 | ❌ 不支援 |
| AED 位置 | ❌ 不支援 |

---

## 3. 用戶故事

### 故事 1：分享地圖位置

> **身為**一位 iMap 使用者  
> **我希望**能分享我目前看到的地圖位置  
> **以便**告訴朋友這個地點在哪裡

**情境描述**：
1. 小明在地圖上找到一家餐廳的位置
2. 點擊右上角的分享按鈕
3. 看到分享對話框，顯示位置資訊和街景圖
4. 複製連結，貼到 LINE 群組
5. 朋友點擊連結，直接看到相同位置

### 故事 2：分享 YouBike 站點

> **身為**一位通勤族  
> **我希望**能分享附近的 YouBike 站點  
> **以便**告訴朋友在哪裡借車

**情境描述**：
1. 小華搜尋附近的 YouBike 站點
2. 找到一個車多的站點，點擊資訊卡片
3. 點擊卡片上的分享按鈕
4. 複製連結傳給朋友
5. 朋友點擊連結，看到該站點的即時車位資訊

### 故事 3：接收分享連結

> **身為**一位收到分享連結的人  
> **我希望**點擊連結就能看到對方分享的內容  
> **以便**快速了解該地點的資訊

**情境描述**：
1. 小花收到朋友傳來的 iMap 連結
2. 點擊連結，自動開啟 iMap
3. 地圖自動移動到分享的位置
4. 畫面顯示該位置的詳細資訊
5. 可以直接導航或查看街景

---

## 4. 功能流程

### 4.1 發送分享（位置分享）

```
使用者瀏覽地圖
    │
    ▼
點擊「分享」按鈕
    │
    ▼
系統取得當前位置，載入街景圖
    │
    ▼
顯示分享對話框
┌─────────────────────────┐
│ • 位置標題              │
│ • 座標資訊              │
│ • 街景縮圖              │
│ • 分享連結              │
│ • [複製] 按鈕           │
│ • [更多分享方式] (手機) │
└─────────────────────────┘
    │
    ▼
使用者複製連結或透過 LINE/FB 分享
```

### 4.2 接收分享

```
使用者點擊分享連結
    │
    ▼
開啟 iMap 網站
    │
    ▼
系統解析連結參數
    │
    ├─ 位置分享 ─▶ 顯示位置資訊
    │
    └─ 項目分享 ─▶ 查詢該項目資料
                        │
                        ▼
              ┌─────────────────────────┐
              │ • 地圖移動到該位置      │
              │ • 標記點位              │
              │ • 顯示資訊面板          │
              └─────────────────────────┘
```

---

## 5. 介面規格

### 5.1 分享對話框

**桌面版**：置中顯示

**手機版**：從底部滑入

```
┌────────────────────────────────────────────┐
│  地圖分享                              ✕   │
├────────────────────────────────────────────┤
│                                            │
│  ┌───────────────────┐    ┌────────────┐  │
│  │ 標題              │    │            │  │
│  │ 地址/座標資訊     │    │ [街景縮圖] │  │
│  └───────────────────┘    └────────────┘  │
│                                            │
│  ┌────────────────────────────┐  ┌─────┐  │
│  │ https://imap.ntpc.gov...   │  │複製 │  │
│  └────────────────────────────┘  └─────┘  │
│                                            │
│  ✅ 已複製到剪貼簿 (複製成功時顯示)        │
│                                            │
│  ┌────────────────────────────────────┐   │
│  │      📤 更多分享方式 (僅手機版)    │   │
│  └────────────────────────────────────┘   │
│                                            │
└────────────────────────────────────────────┘
```

### 5.2 分享資訊面板（接收方）

接收分享連結後，顯示與一般查詢結果相同的資訊卡片，包含：
- 名稱/標題
- 地址或座標
- 街景圖片
- 導航、街景、撥打電話等功能按鈕

---

## 6. 分享連結格式

### 6.1 位置分享

```
https://imap.ntpc.gov.tw/?lat=25.012345&lng=121.456789
```

- `lat`：緯度
- `lng`：經度

### 6.2 項目分享

```
https://imap.ntpc.gov.tw/?layer=bike&id=500101001
```

- `layer`：項目類型（bike = YouBike, activities = 活動）
- `id`：項目編號

---

## 7. 驗收標準

### 7.1 位置分享

| # | 驗收項目 | 通過條件 |
|---|----------|----------|
| 1 | 點擊分享按鈕 | 顯示分享對話框 |
| 2 | 街景圖載入 | 3 秒內顯示街景縮圖 |
| 3 | 複製連結 | 點擊後顯示「已複製」提示 |
| 4 | 手機版分享 | 可呼叫系統分享選單 (LINE, FB...) |
| 5 | 連結有效性 | 他人點擊連結可看到相同位置 |

### 7.2 項目分享

| # | 驗收項目 | 通過條件 |
|---|----------|----------|
| 1 | YouBike 分享 | 連結包含正確站點資訊 |
| 2 | 活動分享 | 連結包含正確活動資訊 |
| 3 | 接收連結 | 地圖自動定位到該項目 |
| 4 | 資訊顯示 | 顯示該項目的詳細資訊卡片 |
| 5 | 標記點位 | 地圖上有明顯的位置標記 |

### 7.3 錯誤處理

| # | 情境 | 預期行為 |
|---|------|----------|
| 1 | 連結參數不完整 | 正常開啟地圖，不顯示分享面板 |
| 2 | 項目不存在 | 顯示「查無此資訊」空狀態畫面 |


---

## 10. 相關文件

- 視覺設計稿：[Figma 連結]
